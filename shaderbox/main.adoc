= Rapid Prototyping of Graphics Shaders in Modern C++
:revealjs_theme: black
:revealjs_transition: fade
:revealjs_controls: true
:revealjs_progress: true
:revealjs_slideNumber: true
:revealjs_history: true
:revealjs_overview: true
:revealjs_fragments: true
:customcss: main.css
:title-slide-background-image: img/title.png
:source-highlighter: highlightjs
:icons: font

== About Me
TODO:

== Agenda
TODO:

== Shaders
[quote]
A computer program that is used to do *shading*
// originally from https://www.clicktorelease.com/talks/scotlandjs-2015/

[state=shading]
== !
image::https://www.clicktorelease.com/talks/scotlandjs-2015/files/CubeSphereConeCylinderNoBackgrnd.jpg[background]
// alternative: https://qph.ec.quoracdn.net/main-qimg-f441c2d9b120a389f6fa5c995080adaf-c

[quote, Wikipedia]
Depicting depth perception in 3D models or illustrations by varying levels of darkness

[state=luxo]
== !
image::https://i.ytimg.com/vi/lkKf9DWmR04/maxresdefault.jpg[background]

[quote, Pixar RenderMan 1988]
A computer program that tells the computer how to draw something
//image::https://upload.wikimedia.org/wikipedia/commons/8/84/Phong-shading-sample.jpg[]
// public domain

== Shaders on Modern GPU's
image::http://images.nvidia.com/products/geforce_9600_gt/GeForce_9600_GT_3qtr_med.png[]
//image::https://cryptosrus.com/wp-content/uploads/2017/10/gpu_mining_cards-1280x550.jpg[background]

== Usage on Modern GPU's
[.step]
- computer graphics
- image manipulation
- general purpose - highly parallel - processing

== Why on GPU
image::https://steemitimages.com/0x0/https://steemitimages.com/DQmbboYVYjvhUetEDhh9bQPXz4AxZTBaDujTkSLBtqn7TYv/image.png[]
// https://steemit.com/gridcoin/@dutch/hardware-and-project-selection-part-1-cpu-vs-gpu

== Types of Shaders
image::https://raw.githubusercontent.com/ssloy/tinyrenderer/gh-pages/img/06-shaders/OpenGL-2.0-Programmable-Shader-Pipeline.png[]
// https://github.com/ssloy/tinyrenderer

image::https://glumpy.github.io/_images/gl-pipeline.png[]
// https://glumpy.github.io/modern-gl.html

== Pixel/Fragment Shader
image::https://i.ytimg.com/vi/JtHm6auVnxA/maxresdefault.jpg[]

IMPORTANT: We will concentrate on image-only shaders

== Motivation
I wanted to create images like...

== !
image::https://i.ytimg.com/vi/__G43hELHL0/maxresdefault.jpg[background]

== !
image::http://boostclock.com/img/bench_app/ShaderToy_volcaninc.jpg[background]

== !
image::http://www.beautypi.com/images/shadertoyvr.jpg[background]

== !
on more limited devices...

== !
image::https://d15shllkswkct0.cloudfront.net/wp-content/blogs.dir/1/files/2016/03/25756567562_59a7e81de5_k.jpg[400, 300]

TODO: replace image

== !
image::https://winblogs.azureedge.net/win/2016/04/Switch-Alpha-12_SA5-271_06.jpg[400, 300]

TODO: replace image

[state=commute]
== !
image::img/commute.png[background]

during long commutes...

[state=gpu_bug]
== !
image::img/snail-bug.png[background]

also because GPU driver render bugs

WARNING: taken on my desktop PC / Nvidia GTX 1060

== !

and finally: full source code debugging - hard/impossible on GPU's

TODO: image of VS debug

== !
Shading Languages

[state=RSL]
== Pixar RenderMan Language
image::https://www.clicktorelease.com/talks/scotlandjs-2015/files/renderman.jpg[background]

[.stretch]
[source, javascript]
-----
/* red mesh */                  /* red shaded mesh */
surface basic() {               surface simple(color myOpacity = 1;) {
    Ci = (1.0, 0.0, 0.0);           color myColor = (1.0, 0.0, 0.0);
    Oi = 1;                         normal Nn = normalize(N);
}                                   Ci = myColor * myOpacity * diffuse(Nn);
                                    Oi = myOpacity;
                                }
-----

== Shading Languages History

Real-time rendering:

[.step]
- ARB assembly language
- Cg programming language
- DirectX Shader Assembly Language
- OpenGL shading language (*GLSL*)
- DirectX High-Level Shader Language (*HLSL*)
- PlayStation Shader Language

== A glimpse of GLSL
// from https://www.opengl.org/sdk/docs/tutorials/ClockworkCoders/lighting.php
[source, javascript]
-----
varying vec3 N;
varying vec3 v;

void main(void)
{
   vec3 L = normalize(gl_LightSource[0].position.xyz - v);
   vec4 Idiff = gl_FrontLightProduct[0].diffuse 
        * max(dot(N,L), 0.0);
   Idiff = clamp(Idiff, 0.0, 1.0);

   gl_FragColor = Idiff;
}
-----

== A glimpse of HLSL
// from https://www.gamasutra.com/view/feature/131275/implementing_lighting_models_with_.php?page=2
[source, javascript]
-----
float4 main(
    float3 Light: TEXCOORD0,
    float3 Norm : TEXCOORD1) : COLOR
{
    float4 diffuse = { 1.0f, 0.0f, 0.0f, 1.0f };
    float4 ambient = { 0.1, 0.0, 0.0, 1.0 };
    return ambient + diffuse * saturate(dot(Light, Norm));
}
-----

== GLSL vs HLSL
// from https://docs.microsoft.com/en-us/windows/uwp/gaming/glsl-to-hlsl-reference
|==============================================================================
| Procedural, step-centric (C like) | Object oriented, data-centric (C++ like)
| Compilation done in driver        | Client side compilation
| `float`, `int`, `bool`            | `float`, `int`, `bool`, `uint`, `double`
|==============================================================================

== GLSL vs HLSL (continued)
|==============================================================================
| Vector type: `vec2`, `vec3`, `vec4` | Vector type: `float2`, `float3`, `float4`
| Matrix type: `mat2`, `mat3`, `mat4` | Matrix type: `float2x2`, `float3x3`, `float4x4`
2+^| ...textures, samplers, precision modifiers etc
|==============================================================================

== Shading Languages Future

Basically C++ (usually via LLVM)

[.step]
- Metal Shading Language (C++14, Apple)
 * only on iOS devices
- CUDA Heterogeneous Computing (C++11, NVidia)
 * only for computing, not graphics
- HLSL 6.x (C++98'ish, Microsoft)
 * not released yet

== !
Let's see how C++ can help out, NOW!

== The Plan

Pick one shading language and emulate it in C++

Bonus: use the preprocessor for transcription back to the original language as well as the main competitor!

== The Plan (continued)

[.step]
- obligatory preprocessor layer
- vector (linear algebra) types
 * swizzle support
- matrix types
- operators
- "standard library" utility/math functions

== Place The Bet

We will chose *GLSL* as it's used on _desktop_, _web_ and _mobile_

WARNING: only a subset of it - concentrate on procedural graphics thus minimize/eliminate inputs (textures, vertex data, etc)

== TODO...

== Showcase

First - crash course into procedural graphics...

== Raymaching into Signed Distance Fields

TODO: obtain permissions from https://twitter.com/ReinderNijhoff

== Results

[%step]
- GPU on desktop PC
 * https://www.shadertoy.com/user/valentingalea
 * Nvidia GeForce 1060
 * 1080p
- CPU on desktop PC
 * AMD FX 8350 8-core 4.00 GHz
 * Microsoft Visual C++ 15.7.6
 * 320x240px

== Results (continued)

- CPU mobile phone
 * Samsung Galaxy S7
 * C4Droid app (https://play.google.com/store/apps/details?id=com.n0n3m4.droidc)
 * GCC 7.2.0
 * 100x100px

[%notitle, background-video="vid/planet.mp4", options="loop,muted"]
== Planet (GPU)

== Planet (CPU)

|==========================================================================================
| image:img/pc_planet.png[Planet(PC)] | image:img/droid_planet.jpg[Planet(Droid), 300, 300]
| Desktop PC                          | Mobile Phone
| .1 FPS :(                           | 5 FPS
|==========================================================================================

== Clouds (GPU)

TODO: capture video

== Clouds (CPU)

TODO: integrate old shader
TODO: capture pics/vid

== Vinyl Turntable (GPU)

TODO: capture video

== Vinyl Turntable (CPU)

TODO: capture pics/vid

== Egg (GPU)

TODO: capture video (disable 3d and longer)
TODO: only on GPU

== The End
